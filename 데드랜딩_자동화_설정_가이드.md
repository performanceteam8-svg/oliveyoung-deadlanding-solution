# 데드랜딩 자동화 설정 가이드 (GitHub Actions + Slack)

매주 지정 요일에 데드랜딩 점검(Step1 → Step2)을 자동 실행하고, 완료/실패 시 Slack 채널에 알림을 보내는 방법입니다.

---

## 1. 전체 흐름

1. **GitHub 저장소**에 코드 푸시
2. **GitHub Secrets**에 Google 서비스 계정 JSON, (선택) Slack Webhook URL 저장
3. **스케줄**: 매주 **월·목 6시(KST)** 에 점검(Step1→Step2) 자동 실행
4. **Slack**: 같은 요일 **오전 9시(KST)** 에 해당 날짜 점검 결과(성공/실패 + 로그)를 지정 채널에 전송

---

## 2. GitHub 저장소 준비

### 2.1 저장소 만들기

- GitHub에서 새 저장소 생성 (Public/Private 상관없음)
- 로컬 프로젝트를 연결하고 푸시:

```bash
cd c:\Users\MADUP\vibecoding
git init
git add .
git commit -m "Add deadlanding automation"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git push -u origin main
```

- **주의**: `.gitignore`에 `credentials/*.json`이 있으므로 키 파일은 올라가지 않습니다. 반드시 Secrets로 넣어야 합니다.

### 2.2 필요한 파일이 모두 포함되었는지 확인

- `deadlanding_step1_collect_urls.py`
- `deadlanding_step2_check_and_fill.py`
- `requirements.txt`
- `.github/workflows/deadlanding-weekly.yml`

---

## 3. GitHub Secrets 등록

저장소 → **Settings** → **Secrets and variables** → **Actions** → **New repository secret**

### 3.1 필수: `CREDENTIALS_JSON`

- **이름**: `CREDENTIALS_JSON`
- **값**: Google 서비스 계정 JSON **전체 내용** (한 줄로 붙여넣어도 되고, 여러 줄 그대로 넣어도 됨)
  - 예: `credentials/oliveyoung-eu-5e0a60023b49.json` 파일을 열어서 전체 복사

### 3.2 선택: `SLACK_WEBHOOK_URL`

- Slack 알림을 쓰려면 Incoming Webhook URL 필요
- **이름**: `SLACK_WEBHOOK_URL`
- **값**: Slack에서 발급한 Webhook URL (Slack 앱 → Incoming Webhooks에서 복사한 주소 전체)

**Slack Webhook 발급 방법**

1. [Slack API](https://api.slack.com/apps) → Create New App → From scratch
2. App 이름·워크스페이스 선택 후 생성
3. **Incoming Webhooks** → On → **Add New Webhook to Workspace** → 알림 받을 채널 선택
4. 생성된 **Webhook URL**을 복사해 `SLACK_WEBHOOK_URL` 시크릿에 붙여넣기

### 3.3 선택: `SPREADSHEET_ID`

- 스프레드시트 ID를 기본값과 다르게 쓰는 경우에만 추가
- **이름**: `SPREADSHEET_ID`
- **값**: 스프레드시트 URL의 `.../d/여기부분/...` 값

워크플로에는 현재 SPREADSHEET_ID를 환경 변수로 넘기는 단계가 없으므로, 다른 시트를 쓰려면 스크립트 내 기본값을 바꾸거나, 워크플로에 `env: SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}`를 추가해 주세요.

---

## 4. 실행 요일·시간 (현재 설정)

- **점검 실행**: 매주 **월·목 06:00 KST** (Step1 → Step2, 결과는 캐시에 저장)
- **Slack 알림**: 매주 **월·목 09:00 KST** (당일 6시 점검 결과를 캐시에서 읽어 전송)

cron은 **UTC 기준**입니다. 변경하려면 `.github/workflows/deadlanding-weekly.yml`의 `schedule`을 수정하세요.

| 용도   | KST 시간  | cron 표현 (UTC) |
|--------|-----------|------------------|
| 점검   | 월·목 6시 | `0 21 * * 0`, `0 21 * * 3` |
| 알림   | 월·목 9시 | `0 0 * * 1`, `0 0 * * 4`   |

- **요일**: `0`=일, `1`=월, `2`=화, `3`=수, `4`=목, `5`=금, `6`=토

---

## 5. 수동 실행

1. GitHub 저장소 → **Actions** 탭
2. 왼쪽에서 **"데드랜딩 주간 점검"** 워크플로 선택
3. **Run workflow** → **Run workflow** 클릭

---

## 6. Slack 알림 내용

- **발송 시각**: 매주 월·목 **오전 9시(KST)**
- **성공 시**: "✅ 데드랜딩 점검 알림 (오전 9시)" + 당일 6시 점검 결과(로그 마지막 25줄)
- **실패 시**: "❌ 데드랜딩 점검 알림 (오전 9시)" + 오전 6시 점검 실패 로그
- **캐시 없음**: 6시 점검이 없었거나 캐시 만료 시 "오늘 오전 6시 점검 결과 캐시 없음" 안내

`SLACK_WEBHOOK_URL`을 등록하지 않으면 Slack 단계는 건너뜁니다 (점검 실행은 그대로 동작).

---

## 7. 문제 해결

| 증상 | 확인 사항 |
|------|------------|
| 스케줄이 안 돌아감 | 저장소에 최근 커밋이 있는지, cron 문법(UTC)이 맞는지 확인. GitHub 스케줄은 최대 15분 정도 지연될 수 있음. |
| Step1/Step2 실패 | Actions 로그에서 에러 메시지 확인. `CREDENTIALS_JSON`이 올바른 JSON인지, 시트 이름·ID가 맞는지 확인. |
| Slack 알림 안 옴 | `SLACK_WEBHOOK_URL` 시크릿 등록 여부, Webhook이 비활성화되지 않았는지 확인. |
| 권한 오류 (403) | 서비스 계정이 해당 스프레드시트에 편집 권한으로 공유되어 있는지 확인. |

---

## 8. 요약 체크리스트

- [ ] GitHub 저장소 생성 후 코드 푸시
- [ ] Secrets에 `CREDENTIALS_JSON` 등록 (필수)
- [ ] (선택) Secrets에 `SLACK_WEBHOOK_URL` 등록
- [ ] (선택) `.github/workflows/deadlanding-weekly.yml`에서 cron으로 요일·시간 조정
- [ ] Actions에서 수동 실행 한 번 해 보기
- [ ] 다음 스케줄일까지 대기하거나, cron을 5분마다 등으로 잠시 바꿔서 자동 실행 확인

이 순서대로 하면 매주 지정한 요일에 자동 실행되고, Slack을 설정했다면 해당 채널에 알림이 전송됩니다.
