# 음성 추출 솔루션 기획안

## 1. 프로젝트 개요

### 1.1 목적
- 다양한 언어 나래이션이 포함된 영상의 내용을 텍스트로 변환 및 번역하여 내용을 쉽고 빠르게 이해하기 위함
- 틱톡 영상의 음성을 자동으로 추출하여 스크립트화하고 번역하는 워크플로우 구축
- 구글 스프레드시트 기반의 링크 관리 및 결과 저장 시스템 구축

### 1.2 핵심 기능
1. 구글 스프레드시트에서 틱톡 게시글 링크 목록 읽기
2. 각 링크의 영상 다운로드 및 음성 추출
3. 음성을 텍스트로 변환 (STT: Speech-to-Text)
4. 텍스트를 영어 또는 한국어로 번역
5. 원문 및 번역 결과를 구글 스프레드시트에 저장

---

## 2. 시스템 아키텍처

### 2.1 전체 흐름도
```
[구글 스프레드시트] 
    ↓ (틱톡 링크 목록 읽기)
[영상 다운로드 모듈]
    ↓ (yt-dlp를 통한 영상 다운로드)
[음성 추출 모듈]
    ↓ (ffmpeg를 통한 오디오 추출)
[음성 인식 모듈 (STT)]
    ↓ (Whisper/Google STT를 통한 텍스트 변환)
[번역 모듈]
    ↓ (Google Translate/DeepL을 통한 번역)
[결과 저장]
    └→ [구글 스프레드시트 업데이트]
```

### 2.2 주요 컴포넌트
1. **스프레드시트 리더**: 구글 스프레드시트에서 틱톡 링크 목록 추출
2. **영상 다운로더**: 틱톡 영상 다운로드 (yt-dlp)
3. **음성 추출기**: 영상에서 오디오 추출 (ffmpeg)
4. **음성 인식기**: 오디오를 텍스트로 변환 (STT API)
5. **번역기**: 텍스트를 목표 언어로 번역 (번역 API)
6. **스프레드시트 업데이터**: 결과를 스프레드시트에 저장

---

## 3. 기술 스택 제안

### 3.1 언어 및 런타임
- **Python 3.8+** (추천)
  - 멀티미디어 처리 라이브러리 풍부
  - 구글 API, 번역 API 라이브러리 다양
  - 비동기 처리 지원 (asyncio)

### 3.2 주요 라이브러리
- **gspread**: 구글 스프레드시트 API 연동
- **google-auth**: 구글 API 인증
- **yt-dlp**: 틱톡 영상 다운로드
- **ffmpeg-python** 또는 **subprocess**: 오디오 추출
- **openai-whisper** 또는 **google-cloud-speech**: 음성 인식 (STT)
- **googletrans** 또는 **deep-translator**: 텍스트 번역
- **requests**: HTTP 요청 처리

### 3.3 외부 도구
- **ffmpeg**: 오디오/비디오 처리 (시스템 설치 필요)
- **yt-dlp**: 영상 다운로드 도구 (Python 패키지로 설치 가능)

### 3.4 배포 환경
- **옵션 1**: 클라우드 함수 (Google Cloud Functions, AWS Lambda) - 파일 저장소 필요
- **옵션 2**: 서버리스 환경 (Heroku, Railway) - 임시 파일 저장 공간 필요
- **옵션 3**: 로컬 서버 또는 클라우드 VM (Google Cloud VM, AWS EC2)
- **옵션 4**: Google Colab (일회성 작업용)

---

## 4. 데이터 흐름 상세

### 4.1 구글 스프레드시트 구조
```
| 틱톡 링크 | 원문 스크립트 | 번역 언어 | 번역 결과 | 처리 상태 | 처리 일시 | 비고 |
|----------|--------------|----------|----------|----------|----------|------|
| https://tiktok.com/@user/video/123 | | 영어 | | 대기중 | | |
| https://tiktok.com/@user/video/456 | 안녕하세요 | 한국어 | Hello | 완료 | 2024-01-15 10:00 | |
```

### 4.2 처리 단계별 상세

#### Step 1: 영상 다운로드
- **입력**: 틱톡 URL
- **처리**: yt-dlp를 사용하여 영상 다운로드
- **출력**: 영상 파일 (MP4 등)
- **고려사항**: 
  - 틱톡은 쿠키/세션 필요할 수 있음
  - 영상 품질 선택 (최저 품질로 다운로드하여 용량 절감)

#### Step 2: 음성 추출
- **입력**: 영상 파일
- **처리**: ffmpeg를 사용하여 오디오 추출
- **출력**: 오디오 파일 (MP3, WAV 등)
- **고려사항**:
  - 오디오 포맷은 STT API 요구사항에 맞춤
  - 샘플링 레이트 조정 (일반적으로 16kHz)

#### Step 3: 음성 인식 (STT)
- **입력**: 오디오 파일
- **처리**: STT API를 사용하여 텍스트 변환
- **출력**: 원문 텍스트 (인식된 언어)
- **옵션 1**: OpenAI Whisper (오픈소스, 무료, 오프라인 가능)
- **옵션 2**: Google Cloud Speech-to-Text (유료, 정확도 높음)
- **옵션 3**: Azure Speech Services (유료)
- **고려사항**:
  - 언어 자동 감지 또는 명시적 지정
  - 긴 오디오는 청크 단위로 분할 처리

#### Step 4: 번역
- **입력**: 원문 텍스트
- **처리**: 번역 API를 사용하여 목표 언어로 번역
- **출력**: 번역된 텍스트
- **옵션 1**: Google Translate API (유료, 정확도 높음)
- **옵션 2**: DeepL API (유료, 품질 우수)
- **옵션 3**: googletrans (무료, 비공식 라이브러리, 제한적)
- **고려사항**:
  - 번역 언어 선택 (영어 또는 한국어)
  - 긴 텍스트는 청크 단위로 분할

#### Step 5: 결과 저장
- **입력**: 원문 텍스트, 번역 텍스트
- **처리**: 구글 스프레드시트에 결과 저장
- **출력**: 스프레드시트 업데이트

### 4.3 처리 로직
```
FOR each 틱톡 링크 in 스프레드시트:
    1. 영상 다운로드 (yt-dlp)
    2. 음성 추출 (ffmpeg)
    3. 음성 인식 (STT API) → 원문 텍스트
    4. 번역 (번역 API) → 번역 텍스트
    5. 스프레드시트에 결과 저장
    6. 임시 파일 삭제 (영상, 오디오)
    
에러 처리:
    - 다운로드 실패 시 상태 업데이트
    - STT 실패 시 재시도 또는 스킵
    - 번역 실패 시 원문만 저장
```

---

## 5. 구현 단계

### Phase 1: 환경 설정 및 기본 구조
1. **프로젝트 초기화**
   - Python 가상환경 설정
   - 필요한 라이브러리 설치
   - 설정 파일 구조 설계

2. **구글 API 설정**
   - Google Cloud Console에서 프로젝트 생성
   - Google Sheets API 활성화
   - 서비스 계정 생성 및 키 다운로드
   - 스프레드시트에 서비스 계정 공유

3. **외부 도구 설치**
   - ffmpeg 시스템 설치
   - yt-dlp Python 패키지 설치

4. **STT API 선택 및 설정**
   - 옵션 1: OpenAI Whisper 설치 (로컬 사용)
   - 옵션 2: Google Cloud Speech-to-Text API 활성화 및 인증
   - 옵션 3: Azure Speech Services 설정

5. **번역 API 선택 및 설정**
   - Google Translate API 활성화 및 인증
   - 또는 DeepL API 키 발급
   - 또는 googletrans 라이브러리 테스트

### Phase 2: 핵심 기능 구현
1. **스프레드시트 연동**
   - gspread로 스프레드시트 읽기
   - 틱톡 링크 컬럼 추출
   - 데이터 구조 파악

2. **영상 다운로드 모듈**
   - yt-dlp를 사용한 틱톡 영상 다운로드
   - 에러 핸들링 (비공개 영상, 삭제된 영상 등)
   - 다운로드 진행률 표시

3. **음성 추출 모듈**
   - ffmpeg를 사용한 오디오 추출
   - 오디오 포맷 및 샘플링 레이트 설정
   - 임시 파일 관리

4. **음성 인식 모듈 (STT)**
   - STT API 연동
   - 언어 자동 감지 또는 명시적 지정
   - 긴 오디오 청크 분할 처리
   - 결과 포맷팅 (타임스탬프 포함 여부)

### Phase 3: 번역 및 저장
1. **번역 모듈**
   - 번역 API 연동
   - 목표 언어 설정 (영어/한국어)
   - 긴 텍스트 청크 분할 처리
   - 번역 품질 검증

2. **결과 저장**
   - 원문 텍스트 스프레드시트에 저장
   - 번역 텍스트 스프레드시트에 저장
   - 처리 상태 업데이트 (완료/실패)
   - 처리 일시 기록

3. **임시 파일 관리**
   - 다운로드한 영상 파일 삭제
   - 추출한 오디오 파일 삭제
   - 디스크 공간 관리

### Phase 4: 에러 처리 및 최적화
1. **에러 핸들링**
   - 각 단계별 에러 처리
   - 재시도 로직 구현
   - 실패한 링크 기록 및 알림

2. **성능 최적화**
   - 병렬 처리 (여러 영상 동시 처리)
   - 캐싱 (이미 처리된 링크 스킵)
   - 배치 처리

3. **로깅 및 모니터링**
   - 처리 진행률 로깅
   - 에러 로그 기록
   - 처리 시간 측정

4. **테스트**
   - 단위 테스트
   - 통합 테스트
   - 실제 틱톡 링크로 테스트

---

## 6. 필요한 API 및 서비스

### 6.1 구글 API
- **Google Sheets API**: 스프레드시트 읽기/쓰기
- **서비스 계정**: 서버 간 인증
- **필요 권한**: 스프레드시트 읽기, 편집

### 6.2 STT (Speech-to-Text) 서비스
- **옵션 1**: OpenAI Whisper (오픈소스, 무료)
  - 로컬 설치 필요
  - GPU 가속 권장 (선택사항)
- **옵션 2**: Google Cloud Speech-to-Text API (유료)
  - API 키 및 인증 필요
  - 사용량 기반 과금
- **옵션 3**: Azure Speech Services (유료)
  - API 키 및 인증 필요

### 6.3 번역 서비스
- **옵션 1**: Google Translate API (유료)
  - API 키 및 인증 필요
  - 사용량 기반 과금
- **옵션 2**: DeepL API (유료)
  - API 키 필요
  - 높은 번역 품질
- **옵션 3**: googletrans (무료, 비공식)
  - 제한적 사용 가능
  - 안정성 낮음

### 6.4 추가 고려사항
- **yt-dlp**: 틱톡 영상 다운로드 (오픈소스, 무료)
- **ffmpeg**: 오디오 추출 (오픈소스, 무료)
- **파일 저장소**: 임시 파일 저장 공간 (로컬 또는 클라우드 스토리지)

---

## 7. 예상 이슈 및 해결 방안

### 7.1 기술적 이슈
1. **문제**: 틱톡 영상 다운로드 실패 (쿠키/세션 필요)
   - **해결**: yt-dlp 쿠키 파일 설정, User-Agent 헤더 설정

2. **문제**: 틱톡 영상이 비공개 또는 삭제됨
   - **해결**: 에러 핸들링 및 스프레드시트에 상태 기록

3. **문제**: STT API 할당량 초과 또는 비용 문제
   - **해결**: OpenAI Whisper 사용 (무료), 또는 청크 단위 처리로 최적화

4. **문제**: 긴 영상 처리 시간
   - **해결**: 청크 단위 분할 처리, 병렬 처리

5. **문제**: 번역 API 할당량 초과
   - **해결**: 텍스트 길이 제한, 배치 처리, 재시도 로직

6. **문제**: 다양한 언어 인식 정확도
   - **해결**: 언어 명시적 지정, Whisper는 다국어 지원 우수

7. **문제**: 배경 음악/효과음으로 인한 인식 정확도 저하
   - **해결**: 오디오 전처리 (노이즈 제거), STT 모델 선택

### 7.2 운영 이슈
1. **문제**: 대량의 영상 처리 시간
   - **해결**: 병렬 처리, 스케줄링, 배치 처리

2. **문제**: 디스크 공간 부족
   - **해결**: 임시 파일 즉시 삭제, 클라우드 스토리지 사용

3. **문제**: API 비용 관리
   - **해결**: 사용량 모니터링, 무료 옵션 우선 사용 (Whisper)

4. **문제**: 틱톡 정책 변경으로 다운로드 불가
   - **해결**: yt-dlp 업데이트, 대체 방법 모색

---

## 8. 확장 가능성

### 8.1 추가 기능 제안
1. **자막 파일 생성**: SRT, VTT 형식으로 자막 파일 생성
2. **타임스탬프 포함**: 원문 및 번역에 타임스탬프 포함
3. **다중 언어 번역**: 여러 언어로 동시 번역
4. **음성 합성 (TTS)**: 번역된 텍스트를 음성으로 변환
5. **대시보드**: 웹 대시보드로 처리 현황 시각화
6. **알림 기능**: 처리 완료 시 슬랙/이메일 알림
7. **언어 자동 감지**: 원문 언어 자동 감지 및 기록
8. **번역 품질 점수**: 번역 품질 평가 및 기록

### 8.2 성능 최적화
1. **캐싱**: 이미 처리된 링크 스킵
2. **병렬 처리**: 여러 영상 동시 처리
3. **증분 업데이트**: 새로 추가된 링크만 처리
4. **배치 처리**: 여러 링크를 한 번에 처리

### 8.3 다른 플랫폼 지원
1. **YouTube**: YouTube 영상 지원 확장
2. **Instagram Reels**: 인스타그램 릴스 지원
3. **Facebook Video**: 페이스북 영상 지원

---

## 9. 보안 고려사항

1. **인증 정보 관리**
   - 환경 변수 또는 시크릿 관리 서비스 사용
   - Git에 민감 정보 커밋 금지

2. **API 키 보호**
   - 서비스 계정 키 파일 안전하게 보관
   - API 키 환경 변수로 관리

3. **접근 제어**
   - 서비스 계정 최소 권한 원칙
   - 스프레드시트 접근 권한 제한

4. **데이터 보안**
   - 임시 파일 안전하게 삭제
   - 민감한 음성 데이터 처리 시 주의

---

## 10. 비용 예상

### 10.1 무료 옵션 (초기 테스트용)
- **OpenAI Whisper**: 무료 (로컬 실행)
- **googletrans**: 무료 (비공식, 제한적)
- **yt-dlp**: 무료
- **ffmpeg**: 무료
- **Google Sheets API**: 무료 (제한적 사용량)

### 10.2 유료 옵션 (프로덕션용)
- **Google Cloud Speech-to-Text**: 약 $0.006/15초
- **Google Translate API**: 약 $20/100만자
- **DeepL API**: 약 €5.49/월 (프로 플랜)
- **클라우드 스토리지**: 사용량 기반 (저렴)

### 10.3 예상 비용 (월간)
- **소규모**: 100개 영상/월 기준
  - Whisper 사용 시: 거의 무료 (서버 비용만)
  - Google STT 사용 시: 약 $10-20
  - 번역: 약 $5-10
- **중규모**: 1,000개 영상/월 기준
  - Google STT: 약 $100-200
  - 번역: 약 $50-100

---

## 11. 프로젝트 일정 예상

- **Phase 1 (환경 설정)**: 2-3일
  - API 설정, 도구 설치, 테스트
- **Phase 2 (핵심 기능)**: 5-7일
  - 다운로드, 음성 추출, STT 구현
- **Phase 3 (번역 및 저장)**: 3-4일
  - 번역 모듈, 결과 저장
- **Phase 4 (에러 처리 및 최적화)**: 3-5일
  - 에러 핸들링, 테스트, 최적화

**총 예상 기간**: 13-19일 (개발자 1명 기준)

---

## 12. 다음 단계

1. **요구사항 확인**: 
   - 번역 목표 언어 명확화 (영어/한국어)
   - 처리할 영상 수 및 빈도 확인
   - 예산 및 무료/유료 옵션 결정

2. **스프레드시트 구조 확인**: 
   - 실제 데이터 구조 파악
   - 컬럼 구조 설계

3. **STT 및 번역 서비스 선택**: 
   - 무료 옵션 (Whisper) vs 유료 옵션 (Google STT) 결정
   - 번역 API 선택 (Google Translate vs DeepL)

4. **테스트 환경 구축**: 
   - 개발용 스프레드시트 준비
   - 테스트용 틱톡 링크 수집
   - API 키 발급 및 설정

5. **기술 스택 최종 결정**: 
   - 배포 환경 선택
   - STT 서비스 최종 결정
   - 번역 서비스 최종 결정

6. **개발 시작**: 
   - Phase 1부터 순차 진행
   - 각 단계별 테스트 수행

---

## 13. 참고 자료

### 13.1 주요 라이브러리 문서
- **yt-dlp**: https://github.com/yt-dlp/yt-dlp
- **OpenAI Whisper**: https://github.com/openai/whisper
- **Google Cloud Speech-to-Text**: https://cloud.google.com/speech-to-text
- **Google Translate API**: https://cloud.google.com/translate
- **gspread**: https://gspread.readthedocs.io/

### 13.2 유용한 리소스
- **ffmpeg 공식 문서**: https://ffmpeg.org/documentation.html
- **TikTok 다운로드 가이드**: yt-dlp 문서 참조
- **STT 비교 가이드**: 각 서비스 비교 문서
