# 데드랜딩 자동화 솔루션 기획안

## 1. 프로젝트 개요

### 1.1 목적
- 광고 랜딩페이지의 데드랜딩 상태를 자동으로 점검
- 제품 품절, 기획전 종료 등으로 인한 데드랜딩 페이지 조기 발견
- 슬랙을 통한 일일 모니터링 리포트 제공
- 구글 스프레드시트에 시각적 표시로 관리 효율성 향상

### 1.2 핵심 기능
1. 구글 스프레드시트에서 랜딩페이지 URL 목록 읽기
2. 각 URL의 데드랜딩 여부 자동 점검
3. 슬랙 채널로 매일 오전 10시 결과 전송
4. 구글 스프레드시트에 데드랜딩 URL 시각적 표시 (빨간색 음영)

---

## 2. 시스템 아키텍처

### 2.1 전체 흐름도
```
[구글 스프레드시트] 
    ↓ (URL 목록 읽기)
[데드랜딩 체크 로직]
    ↓ (HTTP 요청 및 분석)
[결과 처리]
    ├→ [슬랙 알림 전송]
    └→ [구글 스프레드시트 업데이트]
```

### 2.2 주요 컴포넌트
1. **스케줄러**: 매일 오전 10시 실행 트리거
2. **스프레드시트 리더**: 구글 스프레드시트에서 URL 목록 추출
3. **데드랜딩 체커**: 각 URL의 상태 검증
4. **슬랙 알림기**: 결과를 슬랙 채널로 전송
5. **스프레드시트 업데이터**: 데드랜딩 URL에 시각적 표시 적용

---

## 3. 기술 스택 제안

### 3.1 언어 및 런타임
- **Python 3.8+** (추천)
  - 간단한 HTTP 요청 처리
  - 구글 API, 슬랙 API 라이브러리 풍부
  - 스케줄링 라이브러리 다양

### 3.2 주요 라이브러리
- **gspread**: 구글 스프레드시트 API 연동
- **google-auth**: 구글 API 인증
- **requests**: HTTP 요청 (데드랜딩 체크)
- **slack-sdk**: 슬랙 API 연동
- **schedule** 또는 **APScheduler**: 스케줄링
- **beautifulsoup4**: HTML 파싱 (필요시)

### 3.3 배포 환경
- **옵션 1**: 클라우드 함수 (Google Cloud Functions, AWS Lambda)
- **옵션 2**: 서버리스 환경 (Heroku, Railway)
- **옵션 3**: 로컬 서버 + cron job (Windows Task Scheduler)

---

## 4. 데이터 흐름 상세

### 4.1 구글 스프레드시트 구조
```
| URL | 상태 | 마지막 체크일시 | 비고 |
|-----|------|----------------|------|
| https://example.com/page1 | 정상 | 2024-01-15 10:00 | |
| https://example.com/page2 | 데드랜딩 | 2024-01-15 10:00 | 품절 |
```

### 4.2 데드랜딩 판단 기준
1. **HTTP 상태 코드 체크**
   - 404, 500 등 에러 코드
   - 리다이렉트 체인 (무한 리다이렉트 등)

2. **페이지 내용 분석** (선택사항)
   - "품절", "종료", "판매 중지" 등 키워드 검색
   - 특정 요소 존재 여부 (예: 구매 버튼 없음)
   - 메타 태그 분석

3. **응답 시간 체크**
   - 타임아웃 (예: 10초 초과)

### 4.3 처리 로직
```
FOR each URL in 스프레드시트:
    1. HTTP GET 요청
    2. 상태 코드 확인
    3. 응답 본문 분석 (선택)
    4. 데드랜딩 여부 판단
    5. 결과 저장
    
결과 집계:
    - 데드랜딩 개수 카운트
    - 데드랜딩 URL 목록 생성
    
슬랙 전송:
    - 메시지 포맷팅
    - 슬랙 채널로 전송
    
스프레드시트 업데이트:
    - 데드랜딩 행 찾기
    - 배경색 빨간색으로 변경
    - 상태 컬럼 업데이트
```

---

## 5. 구현 단계

### Phase 1: 환경 설정 및 기본 구조
1. **프로젝트 초기화**
   - Python 가상환경 설정
   - 필요한 라이브러리 설치
   - 설정 파일 구조 설계

2. **구글 API 설정**
   - Google Cloud Console에서 프로젝트 생성
   - Google Sheets API 활성화
   - 서비스 계정 생성 및 키 다운로드
   - 스프레드시트에 서비스 계정 공유

3. **슬랙 API 설정**
   - Slack App 생성
   - Bot Token 발급
   - 웹훅 URL 또는 Bot Token 저장

### Phase 2: 핵심 기능 구현
1. **스프레드시트 연동**
   - gspread로 스프레드시트 읽기
   - URL 컬럼 추출
   - 데이터 구조 파악

2. **데드랜딩 체크 로직**
   - HTTP 요청 함수 구현
   - 에러 핸들링 (타임아웃, 연결 실패 등)
   - 상태 코드 기반 판단 로직
   - (선택) HTML 파싱 및 키워드 검색

3. **결과 처리**
   - 데드랜딩 URL 목록 생성
   - 통계 정보 계산

### Phase 3: 알림 및 업데이트
1. **슬랙 알림 구현**
   - 슬랙 메시지 포맷팅
   - 데드랜딩 개수 및 URL 목록 포함
   - 슬랙 채널로 전송

2. **스프레드시트 업데이트**
   - 데드랜딩 행 식별
   - 배경색 변경 (gspread의 format 기능 활용)
   - 상태 컬럼 업데이트
   - 마지막 체크일시 업데이트

### Phase 4: 스케줄링 및 배포
1. **스케줄링 구현**
   - 매일 오전 10시 실행 설정
   - 로깅 시스템 구축
   - 에러 알림 추가

2. **테스트**
   - 단위 테스트
   - 통합 테스트
   - 실제 스프레드시트로 테스트

3. **배포**
   - 배포 환경 선택 및 설정
   - 환경 변수 관리
   - 모니터링 설정

---

## 6. 필요한 API 및 서비스

### 6.1 구글 API
- **Google Sheets API**: 스프레드시트 읽기/쓰기
- **서비스 계정**: 서버 간 인증
- **필요 권한**: 스프레드시트 읽기, 편집

### 6.2 슬랙 API
- **Slack Web API**: 메시지 전송
- **Bot Token**: 인증 토큰
- **필요 권한**: `chat:write`, `channels:read` (채널 정보 확인용)

### 6.3 추가 고려사항
- **HTTP 요청**: 외부 API 불필요 (requests 라이브러리 사용)
- **스케줄링**: 클라우드 함수의 경우 트리거 설정, 로컬의 경우 cron/Task Scheduler

---

## 7. 예상 이슈 및 해결 방안

### 7.1 기술적 이슈
1. **문제**: 스프레드시트 API 할당량 초과
   - **해결**: 요청 간 딜레이 추가, 배치 처리

2. **문제**: 일부 사이트가 봇 차단
   - **해결**: User-Agent 헤더 설정, 필요시 프록시 사용

3. **문제**: JavaScript 렌더링이 필요한 페이지
   - **해결**: Selenium 또는 Playwright 사용 (성능 고려 필요)

4. **문제**: 슬랙 메시지 포맷팅
   - **해결**: Slack Block Kit 활용하여 가독성 향상

### 7.2 운영 이슈
1. **문제**: 데드랜딩 판단 기준의 모호함
   - **해결**: 초기에는 HTTP 상태 코드 중심, 이후 키워드 기반 확장

2. **문제**: 대량의 URL 처리 시간
   - **해결**: 비동기 처리 (asyncio) 또는 멀티스레딩

3. **문제**: 스케줄러 실패 시 알림
   - **해결**: 에러 발생 시 슬랙 알림 추가, 헬스체크 구현

---

## 8. 확장 가능성

### 8.1 추가 기능 제안
1. **히스토리 관리**: 데드랜딩 발생 이력 추적
2. **자동 복구 알림**: 데드랜딩이 해결되었을 때 알림
3. **대시보드**: 웹 대시보드로 시각화
4. **다중 스프레드시트 지원**: 여러 스프레드시트 동시 모니터링
5. **커스텀 체크 규칙**: 도메인별 다른 판단 기준 설정

### 8.2 성능 최적화
1. **캐싱**: 최근 체크 결과 캐싱
2. **병렬 처리**: 여러 URL 동시 체크
3. **증분 업데이트**: 변경된 URL만 체크

---

## 9. 보안 고려사항

1. **인증 정보 관리**
   - 환경 변수 또는 시크릿 관리 서비스 사용
   - Git에 민감 정보 커밋 금지

2. **API 키 보호**
   - 서비스 계정 키 파일 안전하게 보관
   - 슬랙 토큰 환경 변수로 관리

3. **접근 제어**
   - 서비스 계정 최소 권한 원칙
   - 스프레드시트 접근 권한 제한

---

## 10. 프로젝트 일정 예상

- **Phase 1 (환경 설정)**: 1-2일
- **Phase 2 (핵심 기능)**: 3-5일
- **Phase 3 (알림/업데이트)**: 2-3일
- **Phase 4 (스케줄링/배포)**: 2-3일
- **테스트 및 버그 수정**: 2-3일

**총 예상 기간**: 10-16일 (개발자 1명 기준)

---

## 11. 다음 단계

1. **요구사항 확인**: 데드랜딩 판단 기준 명확화
2. **스프레드시트 구조 확인**: 실제 데이터 구조 파악
3. **테스트 환경 구축**: 개발용 스프레드시트 및 슬랙 채널 준비
4. **기술 스택 최종 결정**: 배포 환경 선택
5. **개발 시작**: Phase 1부터 순차 진행
