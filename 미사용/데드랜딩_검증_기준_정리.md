# 데드랜딩 검증 기준 정리 (재정립)

정상/오류 대표 예시를 바탕으로 **정상 페이지가 오류로 잡히지 않도록** 검증 기준을 처음부터 재설정했습니다.

---

## 1. 상품 페이지 vs 기획전 페이지 차이

### 1.1 상품 페이지 (`/product/detail?prdtNo=...`)

| 구분 | 정상 (예: GA230217651) | 오류 (예: GA240121955) |
|------|------------------------|------------------------|
| **최종 URL** | `/product/detail?prdtNo=GA230217651` 유지 | 리다이렉트 → `/product/not-found` |
| **본문 길이** | 길다 (상세, 옵션, 리뷰, 쿠폰 등) | 짧다 (공통 레이아웃만) |
| **본문 내용** | `{{product.brandName}}`, `{{product.prdtName}}`, 가격, "Temporarily Out of Stock", "out of stock", "Not available" 등 **정상 상품 UI 문구** | not-found 전용: **"Product Not Found"** 헤딩 + **"This product may be out of stock, discontinued, or the link is incorrect"** |
| **오류 전용 문구** | 없음 | "This product may be out of stock, discontinued, or the link is incorrect" (이 문장은 **not-found 페이지만** 사용) |

- **주의**: 정상 상품 페이지에도 "Temporarily Out of Stock", "out of stock", "Not available"가 **옵션/버튼**에 나올 수 있음 → 이 단어만으로 오류 처리하면 **오탐(정상을 오류로)** 발생.
- 따라서 상품 오류는 **(1) 최종 URL에 `not-found` 포함** 이거나 **(2) 본문에 위의 긴 문장 전체가 있을 때만** 오류로 판정.

### 1.2 기획전 페이지 (`/event/planning?plndpNo=...`)

| 구분 | 정상 (예: plndpNo=2024) | 오류 (예: plndpNo=1574) |
|------|-------------------------|--------------------------|
| **본문 내용** | 이벤트 제목("✨APP-PY FESTIVAL✨"), **실제 기간**("2026-01-24 00:00 ~ 2026-02-01 00:00 (KST, UTC+9)"), 공지, 쿠폰 등 풀 콘텐츠 | 제목 없음, **날짜 없이** "~ (KST, UTC+9)" 만 있음, 본문 거의 없음 |
| **패턴** | `20XX-XX-XX` 형태의 **실제 날짜**가 본문에 있음 | 날짜 자리만 비어 있는 "~ (KST, UTC+9)" 패턴만 있음 |

- "This is not an ongoing event"는 **JS 팝업**에만 나올 수 있어, 단순 HTTP GET 본문에는 없을 수 있음 → 본문 키워드에서 **제외** (오탐/미탐 방지).
- 대신 **기획전 전용 규칙**: URL이 `event/planning` 이고, **(KST, UTC+9) 앞 150자 안에만** 실제 날짜(20XX-XX-XX)를 검사. 푸터/네비 등 다른 영역에 있는 날짜는 **제외** (그래야 종료된 기획전이 정상으로 잡히지 않음).

---

## 2. 오류 판정 기준 (적용)

다음 **순서**로 검사합니다.

### (1) HTTP 응답 코드

- `2xx` 가 아니면 → **오류**.

### (2) 최종 도착 URL (1순위 – 상품 오류)

- **클릭 후 최종 도착 URL**이 **`not-found`** 이면 → **오류**.
- 서버가 302로 not-found로 보내면 `r.geturl()`이 not-found가 되어 이 조건으로 잡힘.
- 요청 시 Accept / Referer 등 브라우저와 비슷한 헤더를 넣어, 서버가 브라우저와 같이 302를 주는지 확인.

### (2-2) 상품 상세 요청 + 본문에 not-found 경로 (fallback)

- 요청 URL이 **`product/detail`** 이고, 응답 본문에 **`product/not-found`** 경로가 포함되면 → **오류**.
- 브라우저에서는 클릭 시 not-found로 이동하는데, 서버가 302가 아니라 200으로 내려주고 **JS로 not-found로 보내는** 경우를 잡기 위함.

### (2-3) 상품 상세 요청 + `<title>` 안에 미채워진 템플릿

- 요청 URL이 **`product/detail`** 이고, **`<title>...</title>` 안에** **`{{product.`** (미채워진 플레이스홀더)가 포함되면 → **오류**.
- ※ "title이 공통 문구와 같으면 오류" 조건은 사용하지 않음. 정상 상품도 우리 스크립트 요청에는 공통 타이틀만 올 수 있어 오탐이 발생함.

### (3) 본문 키워드 (상품 not-found 전용)

- **오류로 쓰는 문구** (정상 상품 페이지에는 없음):
  - `This product may be out of stock, discontinued, or the link is incorrect`
  - `Product Not Found` (not-found 페이지 헤딩; 리다이렉트 없이 200으로 내려주는 경우 잡기 위함)
- **의도적으로 사용하지 않는 문구** (정상 페이지에도 나와 오탐 가능):
  - `closed`, `out of stock`, `Temporarily Out of Stock`, `discontinued`, `the link is incorrect` (단독), `no longer available`, `event ended`, `This is not an ongoing event` 등

### (4) 기획전 전용 규칙 (URL + 본문 패턴)

- 요청 URL에 **`event/planning`** 이 포함되고,
- 본문에서 **`(KST, UTC+9)` 또는 `~ (KST`** 위치를 찾은 뒤, **그 앞 150자만** 검사.
- 그 **앞 150자 안에** `20XX-XX-XX` 형태 날짜가 **없으면** → **오류** (종료된 기획전).
- (푸터/네비 등 다른 영역의 날짜는 제외해, 종료된 기획전이 정상으로 나오지 않도록 함.)

---

## 3. 예시 매핑 (기대 결과)

| 구분 | URL | 기대 결과 |
|------|-----|-----------|
| 정상 홈 | https://global.oliveyoung.com/ | 정상 |
| 정상 카테고리 | .../display/category?ctgrNo=1000000011 | 정상 |
| 정상 브랜드 | .../display/page/brand-page?brandNo=B00048 | 정상 |
| 정상 상품 | .../product/detail?prdtNo=GA230217651 | 정상 |
| 정상 기획전 | .../event/planning?plndpNo=2024&accParam=170 | 정상 |
| 오류 상품 | .../product/detail?prdtNo=GA240121955 | 오류 (not-found 리다이렉트 또는 not-found 전용 문구) |
| 오류 기획전 | .../event/planning?plndpNo=1574&accParam=170 | 오류 (빈 날짜 패턴만 있고 실제 날짜 없음) |

---

## 4. 코드 반영

- `dead_landing_check_sheets.py`:
  - **DEAD_LANDING_KEYWORDS**: 위 (3)의 **긴 문장 하나만** 유지.
  - **기획전 오류**: URL에 `event/planning` 포함 시, 본문에 `~ (KST` 또는 `(KST, UTC+9)` 있는데 `20\d{2}-\d{2}-\d{2}` 없으면 오류 처리.

키워드 추가/수정 시에는 **오류 페이지에서만** 나오는 문구만 넣고, 정상 페이지에도 나올 수 있는 짧은 단어는 사용하지 않습니다.
